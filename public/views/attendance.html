<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Church Attendance Form</title>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
* {
box-sizing: border-box;
margin: 0;
padding: 0;
}

body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
margin: 0;
padding: 0;
min-height: 100dvh;
display: flex;
justify-content: center;
align-items: flex-start;
overflow-y: auto;
}

.container {
background: #fff;
padding: 25px;
border-radius: 12px;
width: 100%;
max-width: 700px;
box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
}

header {
position: relative;
text-align: center;
margin-bottom: 15px;
}

header h1 {
font-size: 1.8rem;
color: #2c3e50;
}

header p {
color: #7f8c8d;
font-size: 0.9rem;
}

.back-home {
  position: absolute;
  top: 1rem;
  left: 1rem;
  background-color: #226cf5;
  color: #92f520;
  padding: 0.1px 7px;
  text-decoration: none;
}.back-home:hover,

.form-title {
text-align: center;
margin-bottom: 15px;
font-size: 1.3rem;
color: #3498db;
}

.form-title::after {
content: "";
display: block;
width: 50px;
height: 3px;
background: #3498db;
margin: 8px auto;
border-radius: 3px;
}

.form-row {
display: flex;
flex-wrap: wrap;
margin-bottom: 15px;
}

.form-label {
flex: 1 1 130px;
font-weight: 600;
color: #2c3e50;
margin-bottom: 5px;
}

.form-input {
flex: 2 1 300px;
}

.required::after {
content: " *";
color: #e74c3c;
}

.gender-row {
align-items: center;
}

.gender-options {
display: flex;
gap: 30px;
align-items: center;
}

.gender-options .radio-option {
font-weight: normal;
display: flex;
align-items: center;
gap: 5px;
}

@media (max-width: 600px) {
.gender-options {
flex-direction: column;
align-items: flex-start;
gap: 10px;
}
}

input, select, textarea {
width: 100%;
padding: 10px;
border-radius: 6px;
border: 2px solid #e1e8ed;
font-size: 0.95rem;
background-color: #f8f9fa;
}

input:focus, select:focus, textarea:focus {
outline: none;
border-color: #3498db;
background-color: #fff;
}

textarea {
resize: vertical;
min-height: 70px;
}

.radio-group {
display: flex;
gap: 20px;
margin-top: 5px;
}

.radio-option label {
font-weight: normal;
}

button {
margin-top: 15px;
width: 100%;
padding: 12px;
background: linear-gradient(135deg, #3498db, #2980b9);
color: white;
border: none;
font-size: 1rem;
font-weight: 600;
border-radius: 6px;
cursor: pointer;
display: flex;
justify-content: center;
align-items: center;
gap: 10px;
}

button:hover {
background: linear-gradient(135deg, #2980b9, #2573a7);
}

button:disabled {
background: #bdc3c7;
cursor: not-allowed;
}

#message {
margin-top: 15px;
font-weight: 600;
text-align: center;
font-size: 0.95rem;
}

@media (max-width: 600px) {
.form-row {
flex-direction: column;
}

.form-label {
margin-bottom: 5px;
}

.radio-group {
flex-direction: column;
gap: 10px;
}
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(15px); }
to { opacity: 1; transform: translateY(0); }
}

.form-row {
animation: fadeIn 0.4s ease-out;
animation-fill-mode: both;
}

.form-row:nth-child(1) { animation-delay: 0.1s; }
.form-row:nth-child(2) { animation-delay: 0.2s; }
.form-row:nth-child(3) { animation-delay: 0.3s; }
.form-row:nth-child(4) { animation-delay: 0.4s; }
.form-row:nth-child(5) { animation-delay: 0.5s; }
.form-row:nth-child(6) { animation-delay: 0.6s; }
</style>
</head>
<body>
<div class="container">
<header>
<a href="/" class="back-home">←</a>
<h1>Church Attendance Form</h1>
<p>Welcome! Please fill in your details</p>
</header>

<div class="form-title">Attendance Information</div>

<form id="attendanceForm">
<div class="form-row">
<label for="personType" class="form-label required">Person Type</label>
<div class="form-input">
<select id="personType" name="personType" required>
<option value="">Select Type</option>
<option value="member">Member</option>
<option value="visitor">Visitor</option>
</select>
</div>
</div>

<div class="form-row">
<label for="name" class="form-label required">Full Name</label>
<div class="form-input">
<input type="text" id="name" name="name" placeholder="Enter your full name" required />
</div>
</div>

<div class="form-row gender-row">
<label class="form-label required">Gender</label>
<div class="form-input">
<div class="gender-options">
<label class="radio-option"><input type="radio" name="gender" value="male" required> Male</label>
<label class="radio-option"><input type="radio" name="gender" value="female" required> Female</label>
</div>
</div>
</div>

<div class="form-row">
<label for="age" class="form-label required">Age</label>
<div class="form-input">
<input type="number" id="age" name="age" placeholder="Enter your age" min="1" required />
</div>
</div>

<div class="form-row">
<label for="date" class="form-label required">Date</label>
<div class="form-input">
<input type="date" id="date" name="date" required />
</div>
</div>

<div class="form-row">
<label for="comment" class="form-label required">Comment/Feedback</label>
<div class="form-input">
<textarea id="comment" name="comment" placeholder="Share your thoughts or feedback..." required></textarea>
</div>
</div>

<button type="submit" id="submitBtn">
<span id="btnText">Submit Attendance</span>
<span id="loader" style="display:none;">⏳</span>
</button>

<div id="message"></div>
</form>
</div>
<script>
const form = document.getElementById("attendanceForm");
const submitBtn = document.getElementById("submitBtn");
const btnText = document.getElementById("btnText");
const loader = document.getElementById("loader");

document.getElementById("date").valueAsDate = new Date();

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const type = form.personType.value;
  const name = form.name.value.trim();
  const gender = form.gender.value;
  const age = parseInt(form.age.value);
  const date = form.date.value;
  const comment = form.comment.value.trim();

  if (!type || !name || !gender || !age || !date || !comment) {
    Swal.fire({
      icon: 'warning',
      title: 'Incomplete Form',
      text: 'Please fill all required fields.'
    });
    return;
  }

  const ageGroup = age < 18 ? "children" : age <= 39 ? "youth" : "adult";

  const params = new URLSearchParams({
    type,
    name,
    gender,
    ageGroup,
    date,
    comment
  });

  submitBtn.disabled = true;
  btnText.style.display = "none";
  loader.style.display = "inline";

  try {
    const response = await fetch(`/saveAttendance?${params.toString()}`);
    if (!response.ok) throw new Error("Network response was not ok");

    Swal.fire({
      icon: 'success',
      title: 'Success!',
      text: 'Attendance recorded successfully!',
      timer: 3000,
      showConfirmButton: false
    });

    form.reset();
    document.getElementById("date").valueAsDate = new Date();
  } catch (error) {
    Swal.fire({
      icon: 'error',
      title: 'Error',
      text: 'Could not submit attendance.'
    });
  } finally {
    submitBtn.disabled = false;
    btnText.style.display = "inline";
    loader.style.display = "none";
  }
});
</script>
</body>
</html>
